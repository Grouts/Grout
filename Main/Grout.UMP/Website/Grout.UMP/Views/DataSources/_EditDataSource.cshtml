<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>
        Update Data Source popup
    </title>
    @Styles.Render("~/styles/add-datasource")
    @Scripts.Render("~/scripts/edit-datasource")
</head>
<body style="background-color:white">
    <div class="col-md-12 header-menu">
        <span class="su su-datasource Head-icon"></span>
        <span class="PopupTitle">Update Data Source</span>
        <a href="javascript:void(0);" title="Close" class="PopupClose" onclick="parent.onDataSourceEditDialogClose()" ><span class="su su-close"></span></a>
    </div>
    <div id="datasource_popup_module">
        <div class="datasource-btns">
            <div class="pull-right">
                <input type='button' title='' id="publish_datasource" value='Update' onclick="updateDataSource()" class='btn btn-primary' data-mapid="name" tabindex="17">
                <input type='button' title='' value='Cancel' class='btn btn-link' onclick="parent.onDataSourceEditDialogClose()" tabindex="18">
            </div>
        </div>
        <form id='new_datasource_tab_content' class='col-md-12 rdl-datasource-tab-contents' autocomplete="off">
            <div class='col-md-12 no-top-margin new-datasource-content-holder' id='new_datasource_content_holder'>
                <table id='datasource_table'>
                    <tr>
                        <td>
                            <div class="bottom-margin30">Name<span class="Mandatory">*</span></div>
                        </td>
                        <td>
                            <input type='text' id='new_datasource_name' name="new_datasource_name" class='form-control validate-fields edit-text-fields bottom-margin30' maxlength="100" tabindex="1" autofocus />
                            <span id='datasource_name_validation_error' class='datasource-validation-messages'></span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="bottom-margin30">Description</div>
                        </td>
                        <td>
                            <textarea id='new_datasource_description' name="new_datasource_description" class='form-control edit-text-fields bottom-margin30' maxlength="1024" tabindex="2"></textarea>
                            <div class="notification">
                                *1024 characters maximum
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><div class="bottom-margin30">Data Source type</div></td>
                        <td>
                            <div class="bottom-margin30">
                                <select id="datasource_type" class="selectpicker" data-size="5" title="Select Data Source" style="width:100%" tabindex="3">
                                    <option value="SQL">Microsoft SQL Server</option>
                                    <option value="SQLCe">SQLCE</option>
                                    <option value="OLEDB">OLE DB</option>
                                    <option value="ORACLE">Oracle</option>
                                    <option value="ODBC">ODBC</option>
                                    <option value="XML">XML</option>
                                </select>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="bottom-margin30">Connection string</div>
                        </td>
                        <td>
                            <textarea id='new_datasource_connectionstring' name="new_datasource_connectionstring" class='form-control validate-fields bottom-margin30' tabindex="4"></textarea>
                            <span id='datasource_connstring_validation_error' class='datasource-validation-messages'></span>
                        </td>
                    </tr>
                    <tr id="connect_prop">
                        <td>
                            <span>Connect using:</span>
                        </td>
                        <td>
                            <div class="full-width connection-types">
                                <div class="full-width no-margin no-padding">
                                    <input type="radio" id="connect_option_prompt" name="connect_using" value="Prompt" checked="checked" tabindex="5" />
                                    <label for="connect_option_prompt" class="radio-btn-labels labels">Credentials supplied by the user running the report</label>
                                </div>
                                <div class="full-width connection-sub-types">
                                    <span>Display the following text to prompt user for a username and password:</span>
                                </div>
                                <div class="full-width connection-sub-types">
                                    <input type="text" id="prompt_text" value="Type or enter a username and password to access the Data Source:" class="form-control connection-type-prompt bottom-margin30" tabindex="6" />
                                </div>
                                <div class="full-width connection-sub-types">
                                    <input id="enable_windows_prompt" type="checkbox" class="nodetext connection-type-prompt" tabindex="7" />
                                    <label for="enable_windows_prompt" class="clslab NotificationContent cbk-labels">Use as Windows credentials when connecting to the Data Source</label>
                                </div>
                            </div>
                            <div class="full-width connection-types">
                                <div class="full-width no-margin no-padding">
                                    <input type="radio" id="connect_option_store" name="connect_using" value="Store" tabindex="8" />
                                    <label for="connect_option_store" class="radio-btn-labels labels">Credentials stored securely in the report server</label>
                                </div>
                                <div class="full-width connection-sub-types">
                                    <table>
                                        <tr>
                                            <td>Username:</td>
                                            <td>
                                                <input type="text" class="form-control connection-type-server validate-fields edit-text-fields" name="connection_stored_username" id="connection_stored_username" style="width: 250px;" tabindex="9" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Password:</td>
                                            <td>
                                                <input type="password" class="form-control connection-type-server validate-fields edit-text-fields" name="connection_stored_password" id="connection_stored_password" style="width: 250px;" tabindex="10" />
                                            </td>
                                        </tr>
                                    </table>
                                    <span id="datasource_credential_validation_error1" class="datasource-validation-messages"></span>
                                    <span id="datasource_credential_validation_error2" class="datasource-validation-messages"></span>
                                </div>
                                <div class="full-width connection-sub-types">
                                    <input id="enable_windows_stored" type="checkbox" class="nodetext connection-type-server" tabindex="11" />
                                    <label for="enable_windows_stored" class="clslab NotificationContent cbk-labels">Use as Windows credentials when connecting to the Data Source</label>
                                </div>
                                <div class="full-width connection-sub-types">
                                    <input id="enable_impersonate" type="checkbox" class="nodetext connection-type-server" tabindex="12" />
                                    <label for="enable_impersonate" class="clslab NotificationContent labels cbk-labels">Impersonate the authenticated user after a connection has been made to the Data Source</label>
                                </div>
                            </div>
                            <div class="full-width connection-types">
                                <input type="radio" id="connect_option_windows" name="connect_using" value="Integrated" tabindex="13" />
                                <label for="connect_option_windows" class="radio-btn-labels labels">Windows Integrated Security</label>
                            </div>
                            <div class="full-width connection-types">
                                <input type="radio" id="connect_option_none" name="connect_using" value="None" tabindex="14" />
                                <label for="connect_option_none" class="radio-btn-labels labels">Credentials are not required</label>
                            </div>
                            <div class="full-width connection-types">
                                <input id="test_connection" type="button" value="TEST CONNECTION" onclick="onTestDataSourceConnection()" class="btn btn-success" tabindex="15">
                            </div>
                            <div class="full-width connection-types">
                                <span id="connection_test_validation_error" class="datasource-validation-messages"></span>
                            </div>
                        </td>
                    </tr>
                    <tr id="version_comment_tr">
                        <td>
                            <span>Version comments</span>
                        </td>
                        <td>
                            <input id="comment" class="form-control input-fields" type="text" value="" readonly="" tabindex="16">
                        </td>
                    </tr>
                </table>
            </div><div class='horizontal-splitline no-top-margin'></div>
        </form>
    </div>
</body>
</html>
<script>
    $(function () {
        $("#new_datasource_tab_content").css("height", window.innerHeight - 113 + "px");
        $("#enable_windows_prompt").ejCheckBox({ size: "medium", change: onCheckboxChange });
        $("#enable_impersonate").ejCheckBox({ size: "medium", change: onCheckboxChange });
        $("#enable_windows_stored").ejCheckBox({ size: "medium", change: onCheckboxChange });
        $("#connect_option_prompt").ejRadioButton({ size: "medium", change: onConnectionTypeChange });
        $("#connect_option_store").ejRadioButton({ size: "medium", change: onConnectionTypeChange });
        $("#connect_option_windows").ejRadioButton({ size: "medium", change: onConnectionTypeChange });
        $("#connect_option_none").ejRadioButton({ size: "medium", change: onConnectionTypeChange });
        createEditDataSourcePopup(@Html.Raw(Json.Encode(ViewData["dataSourceInfo"])),@Html.Raw(Json.Encode(ViewData["dataSourceDefinition"])));
        parent.$("#datasource_edit_popup_wrapper").ejWaitingPopup("hide");
        $("#datasource_type").on("change", function (e) {
            $("#datasource_connstring_validation_error").html("");
            if (this.value == "XML") {
                $("#test_connection").attr("disabled", "disabled");
            }
            else if ($('input:radio[name=connect_using]:checked').val() != "Prompt") {
                $("#test_connection").removeAttr("disabled");
            }
            dataSourceEditValidation();
        });

        $(document).on("keyup", ".edit-text-fields", function (e) {
            if ($(this).attr("id") === "new_datasource_name") {
                if (window.editData.Name !== $(this).val()) {
                    window.editData.IsNameChanged = true;
                }
                else {
                    window.editData.IsNameChanged = false;
                }
            }
            if ($(this).attr("id") === "new_datasource_description") {
                if (window.editData.Description !== $(this).val()) {
                    window.editData.IsDescriptionChanged = true;
                }
                else {
                    window.editData.IsDescriptionChanged = false;
                }
            }
            dataSourceEditValidation();
        });
        $(document).on("keyup", "#new_datasource_connectionstring", function (e) {
            dataSourceEditValidation();
        });
        window.parent.$("#datasource_edit_popup_wrapper").ejWaitingPopup("hide");
    });
</script>